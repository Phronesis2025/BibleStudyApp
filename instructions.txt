# Bible Study App Design Specification

## Dark Mode Design
- Background: Dark gradient from gray-900 to blue-900
- Text: White and gray-400 for secondary text
- Accents: Sky-400 for interactive elements
- Cards: Semi-transparent dark backgrounds with subtle borders
- Hover states: Subtle lightening of backgrounds
- Focus states: Sky-400 outline
- Loading states: Sky-400 spinners
- Error states: Red-400 text
- Success states: Green-400 text

## Layout Structure
- Header: Fixed position with dark background
- Main content: Centered with max-width-7xl
- Sidebar: Fixed position on desktop, bottom on mobile
- Cards: Consistent padding and border radius
- Forms: Dark backgrounds with light text
- Buttons: Sky-400 with hover states
- Links: Sky-400 with underline on hover

## Reading Page (`app/reading/page.tsx`)
- **Purpose:** Display Bible verses with commentary and reflection tools.
- **Layout:** Two-column on desktop, single column on mobile.
- **Main Content:**
  - Verse input form with dark mode styling
  - Skeleton UI during commentary loading
  - Commentary section with:
    - General meaning of the verse (1-2 sentences)
    - Key themes displayed at top with theme tags (flex-wrap layout)
    - "Reading it Right" section with Historical Context, Commentary details, and Denominational Perspectives
    - "Applying This Verse in Today's World" section with practical application
  - Reflection form with question and answer fields (minimum 10 characters required)
  - Share button with success/error states
  - Save button disabled until answer meets minimum length requirement
- **Sidebar:** Display shared reflections with theme tags, verse references, and likes.
  - Always shows exactly 3 theme tags per reflection for consistency
  - Shows reflections from all users within the last 30 days
  - Theme tags use color-coded background and icons based on theme type
  - Like functionality with red heart icon for liked items

## API Routes

### `/api/verse`
- **Purpose:** Fetch Bible verses from ESV API.
- **Request:** POST with body containing `verse` (string).
- **Response:** JSON object with keys: `passages` (array of verse texts), `query` (original query).

### `/api/commentary`
- **Purpose:** Generate AI commentary on Bible verses.
- **Request:** POST with body containing `verse` (string), `content` (string).
- **Response:** JSON object with keys:
  - `historical_context` (string)
  - `general_meaning` (string) - 1-2 sentences explaining the verse's meaning in simple terms
  - `commentary` (object with summarize, expose, change, prepare)
  - `application` (string)
  - `denominational_perspectives` (object with protestant, baptist, catholic)
  - `themes` (array of exactly 3 theme strings selected for their relevance to the verse)
  - `questions` (array of reflective questions)
- **Theme Restriction:** Only returns themes from the pre-defined list: faith, love, hope, grace, mercy, peace, wisdom, truth, salvation, righteousness, joy, forgiveness, obedience, humility, trust, prayer, service, holiness, redemption, eternity, teaching, accountability.
- **Theme Processing:** 
  - Enhanced OpenAI prompt strictly enforces theme selection from the pre-defined list
  - Improved theme mapping logic to avoid duplicates and select more relevant alternatives
  - Alternative theme mappings prioritize contextually appropriate themes (e.g., strength â†’ wisdom rather than hope)
  - Ensures exactly 3 unique and relevant themes are returned, even if OpenAI returns duplicates or non-allowed themes

### `/api/like`
- **Purpose:** Like or unlike a reflection.
- **Request:** POST with body containing userId, reflectionId, like (boolean, true to like, false to unlike).
- **Response:** JSON object with keys: success (boolean), likes (updated number of likes), likedBy (array of user IDs who liked the reflection).
- **Processing:** 
  - Updates the likes count based on the user's action (increment when liking, decrement when unliking)
  - Manages the liked_by array to track which users have liked each reflection
  - Returns the updated likes count and liked_by array in the response

## Database Schema

### `reflections` table
- `id` (uuid, primary key)
- `user_id` (uuid, foreign key)
- `verse` (text)
- `verse_text` (text)
- `question` (text)
- `answer` (text)
- `insight` (text)
- `themes` (text[]) - Always contains exactly 3 themes from the pre-defined list
- `likes` (integer, default 0)
- `liked_by` (text[]) - Array of user IDs who liked the reflection
- `created_at` (timestamp)

### `reading_log` table
- `id` (uuid, primary key)
- `user_id` (uuid, foreign key)
- `verse` (text)
- `created_at` (timestamp)

### `users` table
- `id` (uuid, primary key)
- `name` (text)
- `created_at` (timestamp)

## Theme Configuration
Each theme has:
- Background color (with 20% opacity)
- Text color
- Icon name

Themes:
1. faith: blue-600/20, text-blue-400, CrossIcon
2. love: pink-600/20, text-pink-400, HeartIcon
3. hope: green-600/20, text-green-400, SunIcon
4. grace: purple-600/20, text-purple-400, GiftIcon
5. mercy: pink-600/20, text-pink-400, HandRaisedIcon
6. peace: green-600/20, text-green-400, DoveIcon
7. wisdom: indigo-600/20, text-indigo-400, LightBulbIcon
8. truth: teal-600/20, text-teal-400, CheckCircleIcon
9. salvation: orange-600/20, text-orange-400, ShieldCheckIcon
10. righteousness: amber-600/20, text-amber-400, ScaleIcon
11. joy: yellow-600/20, text-yellow-400, SparklesIcon
12. forgiveness: pink-600/20, text-pink-400, HeartshakeIcon
13. obedience: blue-600/20, text-blue-400, CheckIcon
14. humility: indigo-600/20, text-indigo-400, ArrowDownIcon
15. trust: teal-600/20, text-teal-400, LockClosedIcon
16. prayer: purple-600/20, text-purple-400, DoveIcon
17. service: green-600/20, text-green-400, UsersIcon
18. holiness: amber-600/20, text-amber-400, StarIcon
19. redemption: orange-600/20, text-orange-400, ArrowPathIcon
20. eternity: cyan-600/20, text-cyan-400, ClockIcon
21. teaching: violet-600/20, text-violet-400, BookOpenIcon
22. accountability: rose-600/20, text-rose-400, UserGroupIcon 